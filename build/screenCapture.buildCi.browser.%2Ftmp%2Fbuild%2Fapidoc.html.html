<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/trentm/node-bunyan#readme">bunyan (v1.8.10)</a>
</h1>
<h4>a JSON logging library for node.js services</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.bunyan">module bunyan</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.bunyan">
            function <span class="apidocSignatureSpan"></span>bunyan
            <span class="apidocSignatureSpan">(options, _childOptions, _childSimple)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.RingBuffer">
            function <span class="apidocSignatureSpan">bunyan.</span>RingBuffer
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.RotatingFileStream">
            function <span class="apidocSignatureSpan">bunyan.</span>RotatingFileStream
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.createLogger">
            function <span class="apidocSignatureSpan">bunyan.</span>createLogger
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.resolveLevel">
            function <span class="apidocSignatureSpan">bunyan.</span>resolveLevel
            <span class="apidocSignatureSpan">(nameOrNum)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.safeCycles">
            function <span class="apidocSignatureSpan">bunyan.</span>safeCycles
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.super_">
            function <span class="apidocSignatureSpan">bunyan.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">bunyan.</span>DEBUG</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">bunyan.</span>ERROR</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">bunyan.</span>FATAL</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">bunyan.</span>INFO</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">bunyan.</span>LOG_VERSION</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">bunyan.</span>TRACE</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">bunyan.</span>WARN</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">bunyan.</span>RingBuffer.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">bunyan.</span>RotatingFileStream.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">bunyan.</span>levelFromName</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">bunyan.</span>nameFromLevel</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">bunyan.</span>stdSerializers</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">bunyan.</span>VERSION</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.bunyan.RingBuffer">module bunyan.RingBuffer</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.RingBuffer.RingBuffer">
            function <span class="apidocSignatureSpan">bunyan.</span>RingBuffer
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.RingBuffer.super_">
            function <span class="apidocSignatureSpan">bunyan.RingBuffer.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.bunyan.RingBuffer.prototype">module bunyan.RingBuffer.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.RingBuffer.prototype.destroy">
            function <span class="apidocSignatureSpan">bunyan.RingBuffer.prototype.</span>destroy
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.RingBuffer.prototype.destroySoon">
            function <span class="apidocSignatureSpan">bunyan.RingBuffer.prototype.</span>destroySoon
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.RingBuffer.prototype.end">
            function <span class="apidocSignatureSpan">bunyan.RingBuffer.prototype.</span>end
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.RingBuffer.prototype.write">
            function <span class="apidocSignatureSpan">bunyan.RingBuffer.prototype.</span>write
            <span class="apidocSignatureSpan">(record)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.bunyan.RotatingFileStream">module bunyan.RotatingFileStream</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.RotatingFileStream.RotatingFileStream">
            function <span class="apidocSignatureSpan">bunyan.</span>RotatingFileStream
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.RotatingFileStream.super_">
            function <span class="apidocSignatureSpan">bunyan.RotatingFileStream.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.bunyan.RotatingFileStream.prototype">module bunyan.RotatingFileStream.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.RotatingFileStream.prototype._calcRotTime">
            function <span class="apidocSignatureSpan">bunyan.RotatingFileStream.prototype.</span>_calcRotTime
            <span class="apidocSignatureSpan">(periodOffset)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.RotatingFileStream.prototype._debug">
            function <span class="apidocSignatureSpan">bunyan.RotatingFileStream.prototype.</span>_debug
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.RotatingFileStream.prototype._setRotationTimer">
            function <span class="apidocSignatureSpan">bunyan.RotatingFileStream.prototype.</span>_setRotationTimer
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.RotatingFileStream.prototype._setupNextRot">
            function <span class="apidocSignatureSpan">bunyan.RotatingFileStream.prototype.</span>_setupNextRot
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.RotatingFileStream.prototype.destroy">
            function <span class="apidocSignatureSpan">bunyan.RotatingFileStream.prototype.</span>destroy
            <span class="apidocSignatureSpan">(s)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.RotatingFileStream.prototype.destroySoon">
            function <span class="apidocSignatureSpan">bunyan.RotatingFileStream.prototype.</span>destroySoon
            <span class="apidocSignatureSpan">(s)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.RotatingFileStream.prototype.end">
            function <span class="apidocSignatureSpan">bunyan.RotatingFileStream.prototype.</span>end
            <span class="apidocSignatureSpan">(s)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.RotatingFileStream.prototype.rotate">
            function <span class="apidocSignatureSpan">bunyan.RotatingFileStream.prototype.</span>rotate
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.RotatingFileStream.prototype.write">
            function <span class="apidocSignatureSpan">bunyan.RotatingFileStream.prototype.</span>write
            <span class="apidocSignatureSpan">(s)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.bunyan.stdSerializers">module bunyan.stdSerializers</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.stdSerializers.err">
            function <span class="apidocSignatureSpan">bunyan.stdSerializers.</span>err
            <span class="apidocSignatureSpan">(err)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.stdSerializers.req">
            function <span class="apidocSignatureSpan">bunyan.stdSerializers.</span>req
            <span class="apidocSignatureSpan">(req)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.bunyan.stdSerializers.res">
            function <span class="apidocSignatureSpan">bunyan.stdSerializers.</span>res
            <span class="apidocSignatureSpan">(res)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.bunyan" id="apidoc.module.bunyan">module bunyan</a></h1>


    <h2>
        <a href="#apidoc.element.bunyan.bunyan" id="apidoc.element.bunyan.bunyan">
        function <span class="apidocSignatureSpan"></span>bunyan
        <span class="apidocSignatureSpan">(options, _childOptions, _childSimple)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Logger(options, _childOptions, _childSimple) {
    xxx('Logger start:', options)
    if (!(this instanceof Logger)) {
        return new Logger(options, _childOptions);
    }

    // Input arg validation.
    var parent;
    if (_childOptions !== undefined) {
        parent = options;
        options = _childOptions;
        if (!(parent instanceof Logger)) {
            throw new TypeError(
                'invalid Logger creation: do not pass a second arg');
        }
    }
    if (!options) {
        throw new TypeError('options (object) is required');
    }
    if (!parent) {
        if (!options.name) {
            throw new TypeError('options.name (string) is required');
        }
    } else {
        if (options.name) {
            throw new TypeError(
                'invalid options.name: child cannot set logger name');
        }
    }
    if (options.stream &amp;&amp; options.streams) {
        throw new TypeError('cannot mix "streams" and "stream" options');
    }
    if (options.streams &amp;&amp; !Array.isArray(options.streams)) {
        throw new TypeError('invalid options.streams: must be an array')
    }
    if (options.serializers &amp;&amp; (typeof (options.serializers) !== 'object' ||
            Array.isArray(options.serializers))) {
        throw new TypeError('invalid options.serializers: must be an object')
    }

    EventEmitter.call(this);

    // Fast path for simple child creation.
    if (parent &amp;&amp; _childSimple) {
        // `_isSimpleChild` is a signal to stream close handling that this child
        // owns none of its streams.
        this._isSimpleChild = true;

        this._level = parent._level;
        this.streams = parent.streams;
        this.serializers = parent.serializers;
        this.src = parent.src;
        var fields = this.fields = {};
        var parentFieldNames = Object.keys(parent.fields);
        for (var i = 0; i &lt; parentFieldNames.length; i++) {
            var name = parentFieldNames[i];
            fields[name] = parent.fields[name];
        }
        var names = Object.keys(options);
        for (var i = 0; i &lt; names.length; i++) {
            var name = names[i];
            fields[name] = options[name];
        }
        return;
    }

    // Start values.
    var self = this;
    if (parent) {
        this._level = parent._level;
        this.streams = [];
        for (var i = 0; i &lt; parent.streams.length; i++) {
            var s = objCopy(parent.streams[i]);
            s.closeOnExit = false; // Don't own parent stream.
            this.streams.push(s);
        }
        this.serializers = objCopy(parent.serializers);
        this.src = parent.src;
        this.fields = objCopy(parent.fields);
        if (options.level) {
            this.level(options.level);
        }
    } else {
        this._level = Number.POSITIVE_INFINITY;
        this.streams = [];
        this.serializers = null;
        this.src = false;
        this.fields = {};
    }

    if (!dtp &amp;&amp; dtrace) {
        dtp = dtrace.createDTraceProvider('bunyan');

        for (var level in levelFromName) {
            var probe;

            probes[levelFromName[level]] = probe =
                dtp.addProbe('log-' + level, 'char *');

            // Explicitly add a reference to dtp to prevent it from being GC'd
            probe.dtp = dtp;
        }

        dtp.enable();
    }

    // Handle *config* options (i.e. options that are not just plain data
    // for log records).
    if (options.stream) {
        self.addStream({
            type: 'stream',
            stream: options.stream,
            closeOnExit: false,
            level: options.level
        });
    } else if (options.streams) {
        options.streams.forEach(function (s) {
            self.addStream(s, options.level);
        });
    } else if (parent &amp;&amp; options.level) {
        this.level(options.level);
    } else if (!parent) {
        if (runtimeEnv === 'browser') {
            /*
             * In the browser we'll be emitting to console.log by default.
             * Any console.log worth its salt these days can nicely render ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.bunyan.RingBuffer" id="apidoc.element.bunyan.RingBuffer">
        function <span class="apidocSignatureSpan">bunyan.</span>RingBuffer
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function RingBuffer(options) {
    this.limit = options &amp;&amp; options.limit ? options.limit : 100;
    this.writable = true;
    this.records = [];
    EventEmitter.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  github.com/davepacheco)

  Potential uses: Live debugging if a running process could inspect those
  messages. One could dump recent log messages at a finer log level than is
  typically logged on
  [`uncaughtException`](http://nodejs.org/docs/latest/api/all.html#all_event_uncaughtexception).

var ringbuffer = new bunyan.<span class="apidocCodeKeywordSpan">RingBuffer</span>({ limit: 100 });
var log = new bunyan({
    name: 'foo',
    streams: [{
        type: 'raw',
        stream: ringbuffer,
        level: 'debug'
    }]
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.bunyan.RotatingFileStream" id="apidoc.element.bunyan.RotatingFileStream">
        function <span class="apidocSignatureSpan">bunyan.</span>RotatingFileStream
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function RotatingFileStream(options) {
    this.path = options.path;

    this.count = (options.count == null ? 10 : options.count);
    assert.equal(typeof (this.count), 'number',
        format('rotating-file stream "count" is not a number: %j (%s) in %j',
            this.count, typeof (this.count), this));
    assert.ok(this.count &gt;= 0,
        format('rotating-file stream "count" is not &gt;= 0: %j in %j',
            this.count, this));

    // Parse `options.period`.
    if (options.period) {
        // &lt;number&gt;&lt;scope&gt; where scope is:
        //    h   hours (at the start of the hour)
        //    d   days (at the start of the day, i.e. just after midnight)
        //    w   weeks (at the start of Sunday)
        //    m   months (on the first of the month)
        //    y   years (at the start of Jan 1st)
        // with special values 'hourly' (1h), 'daily' (1d), "weekly" (1w),
        // 'monthly' (1m) and 'yearly' (1y)
        var period = {
            'hourly': '1h',
            'daily': '1d',
            'weekly': '1w',
            'monthly': '1m',
            'yearly': '1y'
        }[options.period] || options.period;
        var m = /^([1-9][0-9]*)([hdwmy]|ms)$/.exec(period);
        if (!m) {
            throw new Error(format('invalid period: "%s"', options.period));
        }
        this.periodNum = Number(m[1]);
        this.periodScope = m[2];
    } else {
        this.periodNum = 1;
        this.periodScope = 'd';
    }

    var lastModified = null;
    try {
        var fileInfo = fs.statSync(this.path);
        lastModified = fileInfo.mtime.getTime();
    }
    catch (err) {
        // file doesn't exist
    }
    var rotateAfterOpen = false;
    if (lastModified) {
        var lastRotTime = this._calcRotTime(0);
        if (lastModified &lt; lastRotTime) {
            rotateAfterOpen = true;
        }
    }

    // TODO: template support for backup files
    // template: &lt;path to which to rotate&gt;
    //      default is %P.%n
    //      '/var/log/archive/foo.log'  -&gt; foo.log.%n
    //      '/var/log/archive/foo.log.%n'
    //      codes:
    //          XXX support strftime codes (per node version of those)
    //              or whatever module. Pick non-colliding for extra
    //              codes
    //          %P      `path` base value
    //          %n      integer number of rotated log (1,2,3,...)
    //          %d      datetime in YYYY-MM-DD_HH-MM-SS
    //                      XXX what should default date format be?
    //                          prior art? Want to avoid ':' in
    //                          filenames (illegal on Windows for one).

    this.stream = fs.createWriteStream(this.path,
        {flags: 'a', encoding: 'utf8'});

    this.rotQueue = [];
    this.rotating = false;
    if (rotateAfterOpen) {
        this._debug('rotateAfterOpen -&gt; call rotate()');
        this.rotate();
    } else {
        this._setupNextRot();
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.bunyan.createLogger" id="apidoc.element.bunyan.createLogger">
        function <span class="apidocSignatureSpan">bunyan.</span>createLogger
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function createLogger(options) {
    return new Logger(options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  running under [NW.js](http://nwjs.io/). Contributions by Adam Lynch, Jeremy
  Ruppel, and Aleksey Timchenko.

- [pull #318] Add `reemitErrorEvents` optional boolean for streams added to a
  Bunyan logger to control whether an "error" event on the stream will be
  re-emitted on the `Logger` instance.

var log = bunyan.<span class="apidocCodeKeywordSpan">createLogger</span>({
    name: 'foo',
    streams: [
        {
            type: 'raw',
            stream: new MyCustomStream(),
            reemitErrorEvents: true
        }
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.bunyan.resolveLevel" id="apidoc.element.bunyan.resolveLevel">
        function <span class="apidocSignatureSpan">bunyan.</span>resolveLevel
        <span class="apidocSignatureSpan">(nameOrNum)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function resolveLevel(nameOrNum) {
    var level;
    var type = typeof (nameOrNum);
    if (type === 'string') {
        level = levelFromName[nameOrNum.toLowerCase()];
        if (!level) {
            throw new Error(format('unknown level name: "%s"', nameOrNum));
        }
    } else if (type !== 'number') {
        throw new TypeError(format('cannot resolve level: invalid arg (%s):',
            type, nameOrNum));
    } else if (nameOrNum &lt; 0 || Math.floor(nameOrNum) !== nameOrNum) {
        throw new TypeError(format('level is not a positive integer: %s',
            nameOrNum));
    } else {
        level = nameOrNum;
    }
    return level;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

- [issue #38] Fix the default `bunyan` CLI output of a `req.body` that is an
  object instead of a string.


## 0.13.3

- Export `bunyan.<span class="apidocCodeKeywordSpan">resolveLevel</span>(NAME-OR-NUM)` to resolve a level name or number
  to its log level number value:

&gt; bunyan.resolveLevel('INFO')
30
&gt; bunyan.resolveLevel('debug')
20
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.bunyan.safeCycles" id="apidoc.element.bunyan.safeCycles">
        function <span class="apidocSignatureSpan">bunyan.</span>safeCycles
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function safeCyclesSet() {
    var seen = new Set();
    return function (key, val) {
        if (!val || typeof (val) !== 'object') {
            return val;
        }
        if (seen.has(val)) {
            return '[Circular]';
        }
        seen.add(val);
        return val;
    };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

See &lt;https://github.com/trentm/node-bunyan#dtrace-support&gt; for details. By
Bryan Cantrill.


## 0.14.6

- Export `bunyan.<span class="apidocCodeKeywordSpan">safeCycles</span>()`. This may be useful for custom `type == "raw"
;`
streams that may do JSON stringification of log records themselves. Usage:

      var str = JSON.stringify(rec, bunyan.safeCycles());

- [issue #49] Allow a `log.child()` to specify the level of inherited streams.
For example:
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.bunyan.super_" id="apidoc.element.bunyan.super_">
        function <span class="apidocSignatureSpan">bunyan.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter() {
  EventEmitter.init.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




























</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.bunyan.RingBuffer" id="apidoc.module.bunyan.RingBuffer">module bunyan.RingBuffer</a></h1>


    <h2>
        <a href="#apidoc.element.bunyan.RingBuffer.RingBuffer" id="apidoc.element.bunyan.RingBuffer.RingBuffer">
        function <span class="apidocSignatureSpan">bunyan.</span>RingBuffer
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function RingBuffer(options) {
    this.limit = options &amp;&amp; options.limit ? options.limit : 100;
    this.writable = true;
    this.records = [];
    EventEmitter.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  github.com/davepacheco)

  Potential uses: Live debugging if a running process could inspect those
  messages. One could dump recent log messages at a finer log level than is
  typically logged on
  [`uncaughtException`](http://nodejs.org/docs/latest/api/all.html#all_event_uncaughtexception).

var ringbuffer = new bunyan.<span class="apidocCodeKeywordSpan">RingBuffer</span>({ limit: 100 });
var log = new bunyan({
    name: 'foo',
    streams: [{
        type: 'raw',
        stream: ringbuffer,
        level: 'debug'
    }]
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.bunyan.RingBuffer.super_" id="apidoc.element.bunyan.RingBuffer.super_">
        function <span class="apidocSignatureSpan">bunyan.RingBuffer.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter() {
  EventEmitter.init.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.bunyan.RingBuffer.prototype" id="apidoc.module.bunyan.RingBuffer.prototype">module bunyan.RingBuffer.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.bunyan.RingBuffer.prototype.destroy" id="apidoc.element.bunyan.RingBuffer.prototype.destroy">
        function <span class="apidocSignatureSpan">bunyan.RingBuffer.prototype.</span>destroy
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">destroy = function () {
    this.writable = false;
    this.emit('close');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 */
Logger.prototype.reopenFileStreams = function () {
var self = this;
self.streams.forEach(function (s) {
    if (s.type === 'file') {
        if (s.stream) {
            // Not sure if typically would want this, or more immediate
            // `s.stream.<span class="apidocCodeKeywordSpan">destroy</span>()`.
            s.stream.end();
            s.stream.destroySoon();
            delete s.stream;
        }
        s.stream = fs.createWriteStream(s.path,
            {flags: 'a', encoding: 'utf8'});
        s.stream.on('error', function (err) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.bunyan.RingBuffer.prototype.destroySoon" id="apidoc.element.bunyan.RingBuffer.prototype.destroySoon">
        function <span class="apidocSignatureSpan">bunyan.RingBuffer.prototype.</span>destroySoon
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">destroySoon = function () {
    this.destroy();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var self = this;
self.streams.forEach(function (s) {
    if (s.type === 'file') {
        if (s.stream) {
            // Not sure if typically would want this, or more immediate
            // `s.stream.destroy()`.
            s.stream.end();
            s.stream.<span class="apidocCodeKeywordSpan">destroySoon</span>();
            delete s.stream;
        }
        s.stream = fs.createWriteStream(s.path,
            {flags: 'a', encoding: 'utf8'});
        s.stream.on('error', function (err) {
            self.emit('error', err, s);
        });
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.bunyan.RingBuffer.prototype.end" id="apidoc.element.bunyan.RingBuffer.prototype.end">
        function <span class="apidocSignatureSpan">bunyan.RingBuffer.prototype.</span>end
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">end = function () {
    if (arguments.length &gt; 0)
        this.write.apply(this, Array.prototype.slice.call(arguments));
    this.writable = false;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  - perhaps this would be a "buffered: true" option on the stream object
  - then wrap the "stream" with a local class that handles the buffering
  - to finish this, need the 'log.close' and `process.on('exit', ...)`
    work that Trent has started.
- "canWrite" handling for full streams. Need to buffer a la log4js
- test file log with logadm rotation: does it handle that?
- test suite:
  - test for a cloned logger double-`stream.<span class="apidocCodeKeywordSpan">end</span>()` causing problems.
    Perhaps the "closeOnExit" for existing streams should be false for
    clones.
  - test that a `log.clone(...)` adding a new field matching a serializer
    works *and* that an existing field in the parent is not *re-serialized*.
- split out `bunyan` cli to a "bunyan" or "bunyan-reader" or "node-bunyan-reader"
as the basis for tools to consume bunyan logs. It can grow indep of node-bunyan
for generating the logs.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.bunyan.RingBuffer.prototype.write" id="apidoc.element.bunyan.RingBuffer.prototype.write">
        function <span class="apidocSignatureSpan">bunyan.RingBuffer.prototype.</span>write
        <span class="apidocSignatureSpan">(record)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">write = function (record) {
    if (!this.writable)
        throw (new Error('RingBuffer has been ended already'));

    this.records.push(record);

    if (this.records.length &gt; this.limit)
        this.records.shift();

    return (true);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
	    npm publish

.PHONY: docs
docs: toc
	@[[ `which ronn` ]] || (echo "No 'ronn' on your PATH. Install with 'gem install ronn'" &amp;&amp;
; exit 2)
	mkdir -p man/man1
	ronn --style=toc --manual="bunyan manual" --date=$(shell git log -1 --pretty=format:%cd --date=short) --roff --html docs
/bunyan.1.ronn
	python -c 'import sys; h = open("docs/bunyan.1.html").read(); h = h.replace(".mp dt.flush {float:left;width
:8ex}", ""); open("docs/bunyan.1.html", "w").<span class="apidocCodeKeywordSpan">write</span>(
h)'
	python -c 'import sys; h = open("docs/bunyan.1.html").read(); h = h.replace("&lt;/body&gt;", "
;""&lt;a href="https://github.com/trentm/node-bunyan"&gt;&lt;img style="position: absolute; top:
0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="
;Fork me on GitHub"&gt;&lt;/a&gt;&lt;/body&gt;"""); open("docs/bunyan.1.html", "w&amp;#
x22;).write(h)'
	@echo "# test with 'man ./docs/bunyan.1' and 'open ./docs/bunyan.1.html'"

# Re-generate the README.md table of contents.
toc:
	./node_modules/.bin/markdown-toc -i README.md
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.bunyan.RotatingFileStream" id="apidoc.module.bunyan.RotatingFileStream">module bunyan.RotatingFileStream</a></h1>


    <h2>
        <a href="#apidoc.element.bunyan.RotatingFileStream.RotatingFileStream" id="apidoc.element.bunyan.RotatingFileStream.RotatingFileStream">
        function <span class="apidocSignatureSpan">bunyan.</span>RotatingFileStream
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function RotatingFileStream(options) {
    this.path = options.path;

    this.count = (options.count == null ? 10 : options.count);
    assert.equal(typeof (this.count), 'number',
        format('rotating-file stream "count" is not a number: %j (%s) in %j',
            this.count, typeof (this.count), this));
    assert.ok(this.count &gt;= 0,
        format('rotating-file stream "count" is not &gt;= 0: %j in %j',
            this.count, this));

    // Parse `options.period`.
    if (options.period) {
        // &lt;number&gt;&lt;scope&gt; where scope is:
        //    h   hours (at the start of the hour)
        //    d   days (at the start of the day, i.e. just after midnight)
        //    w   weeks (at the start of Sunday)
        //    m   months (on the first of the month)
        //    y   years (at the start of Jan 1st)
        // with special values 'hourly' (1h), 'daily' (1d), "weekly" (1w),
        // 'monthly' (1m) and 'yearly' (1y)
        var period = {
            'hourly': '1h',
            'daily': '1d',
            'weekly': '1w',
            'monthly': '1m',
            'yearly': '1y'
        }[options.period] || options.period;
        var m = /^([1-9][0-9]*)([hdwmy]|ms)$/.exec(period);
        if (!m) {
            throw new Error(format('invalid period: "%s"', options.period));
        }
        this.periodNum = Number(m[1]);
        this.periodScope = m[2];
    } else {
        this.periodNum = 1;
        this.periodScope = 'd';
    }

    var lastModified = null;
    try {
        var fileInfo = fs.statSync(this.path);
        lastModified = fileInfo.mtime.getTime();
    }
    catch (err) {
        // file doesn't exist
    }
    var rotateAfterOpen = false;
    if (lastModified) {
        var lastRotTime = this._calcRotTime(0);
        if (lastModified &lt; lastRotTime) {
            rotateAfterOpen = true;
        }
    }

    // TODO: template support for backup files
    // template: &lt;path to which to rotate&gt;
    //      default is %P.%n
    //      '/var/log/archive/foo.log'  -&gt; foo.log.%n
    //      '/var/log/archive/foo.log.%n'
    //      codes:
    //          XXX support strftime codes (per node version of those)
    //              or whatever module. Pick non-colliding for extra
    //              codes
    //          %P      `path` base value
    //          %n      integer number of rotated log (1,2,3,...)
    //          %d      datetime in YYYY-MM-DD_HH-MM-SS
    //                      XXX what should default date format be?
    //                          prior art? Want to avoid ':' in
    //                          filenames (illegal on Windows for one).

    this.stream = fs.createWriteStream(this.path,
        {flags: 'a', encoding: 'utf8'});

    this.rotQueue = [];
    this.rotating = false;
    if (rotateAfterOpen) {
        this._debug('rotateAfterOpen -&gt; call rotate()');
        this.rotate();
    } else {
        this._setupNextRot();
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.bunyan.RotatingFileStream.super_" id="apidoc.element.bunyan.RotatingFileStream.super_">
        function <span class="apidocSignatureSpan">bunyan.RotatingFileStream.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter() {
  EventEmitter.init.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.bunyan.RotatingFileStream.prototype" id="apidoc.module.bunyan.RotatingFileStream.prototype">module bunyan.RotatingFileStream.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.bunyan.RotatingFileStream.prototype._calcRotTime" id="apidoc.element.bunyan.RotatingFileStream.prototype._calcRotTime">
        function <span class="apidocSignatureSpan">bunyan.RotatingFileStream.prototype.</span>_calcRotTime
        <span class="apidocSignatureSpan">(periodOffset)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function _calcRotTime(periodOffset) {
    this._debug('_calcRotTime: %s%s', this.periodNum, this.periodScope);
    var d = new Date();

    this._debug('  now local: %s', d);
    this._debug('    now utc: %s', d.toISOString());
    var rotAt;
    switch (this.periodScope) {
    case 'ms':
        // Hidden millisecond period for debugging.
        if (this.rotAt) {
            rotAt = this.rotAt + this.periodNum * periodOffset;
        } else {
            rotAt = Date.now() + this.periodNum * periodOffset;
        }
        break;
    case 'h':
        if (this.rotAt) {
            rotAt = this.rotAt + this.periodNum * 60 * 60 * 1000 * periodOffset;
        } else {
            // First time: top of the next hour.
            rotAt = Date.UTC(d.getUTCFullYear(), d.getUTCMonth(),
                d.getUTCDate(), d.getUTCHours() + periodOffset);
        }
        break;
    case 'd':
        if (this.rotAt) {
            rotAt = this.rotAt + this.periodNum * 24 * 60 * 60 * 1000
                * periodOffset;
        } else {
            // First time: start of tomorrow (i.e. at the coming midnight) UTC.
            rotAt = Date.UTC(d.getUTCFullYear(), d.getUTCMonth(),
                d.getUTCDate() + periodOffset);
        }
        break;
    case 'w':
        // Currently, always on Sunday morning at 00:00:00 (UTC).
        if (this.rotAt) {
            rotAt = this.rotAt + this.periodNum * 7 * 24 * 60 * 60 * 1000
                * periodOffset;
        } else {
            // First time: this coming Sunday.
            var dayOffset = (7 - d.getUTCDay());
            if (periodOffset &lt; 1) {
                dayOffset = -d.getUTCDay();
            }
            if (periodOffset &gt; 1 || periodOffset &lt; -1) {
                dayOffset += 7 * periodOffset;
            }
            rotAt = Date.UTC(d.getUTCFullYear(), d.getUTCMonth(),
                d.getUTCDate() + dayOffset);
        }
        break;
    case 'm':
        if (this.rotAt) {
            rotAt = Date.UTC(d.getUTCFullYear(),
                d.getUTCMonth() + this.periodNum * periodOffset, 1);
        } else {
            // First time: the start of the next month.
            rotAt = Date.UTC(d.getUTCFullYear(),
                d.getUTCMonth() + periodOffset, 1);
        }
        break;
    case 'y':
        if (this.rotAt) {
            rotAt = Date.UTC(d.getUTCFullYear() + this.periodNum * periodOffset,
                0, 1);
        } else {
            // First time: the start of the next year.
            rotAt = Date.UTC(d.getUTCFullYear() + periodOffset, 0, 1);
        }
        break;
    default:
        assert.fail(format('invalid period scope: "%s"', this.periodScope));
    }

    if (this._debug()) {
        this._debug('  **rotAt**: %s (utc: %s)', rotAt,
            new Date(rotAt).toUTCString());
        var now = Date.now();
        this._debug('        now: %s (%sms == %smin == %sh to go)',
            now,
            rotAt - now,
            (rotAt-now)/1000/60,
            (rotAt-now)/1000/60/60);
    }
    return rotAt;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    lastModified = fileInfo.mtime.getTime();
}
catch (err) {
    // file doesn't exist
}
var rotateAfterOpen = false;
if (lastModified) {
    var lastRotTime = this.<span class="apidocCodeKeywordSpan">_calcRotTime</span>(0);
    if (lastModified &lt; lastRotTime) {
        rotateAfterOpen = true;
    }
}

// TODO: template support for backup files
// template: &lt;path to which to rotate&gt;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.bunyan.RotatingFileStream.prototype._debug" id="apidoc.element.bunyan.RotatingFileStream.prototype._debug">
        function <span class="apidocSignatureSpan">bunyan.RotatingFileStream.prototype.</span>_debug
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_debug = function () {
    // Set this to `true` to add debug logging.
    if (false) {
        if (arguments.length === 0) {
            return true;
        }
        var args = Array.prototype.slice.call(arguments);
        args[0] = '[' + (new Date().toISOString()) + ', '
            + this.path + '] ' + args[0];
        console.log.apply(this, args);
    } else {
        return false;
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

    this.stream = fs.createWriteStream(this.path,
        {flags: 'a', encoding: 'utf8'});

    this.rotQueue = [];
    this.rotating = false;
    if (rotateAfterOpen) {
        this.<span class="apidocCodeKeywordSpan">_debug</span>('rotateAfterOpen -&gt; call rotate()');
        this.rotate();
    } else {
        this._setupNextRot();
    }
}

util.inherits(RotatingFileStream, EventEmitter);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.bunyan.RotatingFileStream.prototype._setRotationTimer" id="apidoc.element.bunyan.RotatingFileStream.prototype._setRotationTimer">
        function <span class="apidocSignatureSpan">bunyan.RotatingFileStream.prototype.</span>_setRotationTimer
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_setRotationTimer = function () {
    var self = this;
    var delay = this.rotAt - Date.now();
    // Cap timeout to Node's max setTimeout, see
    // &lt;https://github.com/joyent/node/issues/8656&gt;.
    var TIMEOUT_MAX = 2147483647; // 2^31-1
    if (delay &gt; TIMEOUT_MAX) {
        delay = TIMEOUT_MAX;
    }
    this.timeout = setTimeout(
        function () {
            self._debug('_setRotationTimer timeout -&gt; call rotate()');
            self.rotate();
        },
        delay);
    if (typeof (this.timeout.unref) === 'function') {
        this.timeout.unref();
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
} else {
    return false;
}
};

RotatingFileStream.prototype._setupNextRot = function () {
this.rotAt = this._calcRotTime(1);
this.<span class="apidocCodeKeywordSpan">_setRotationTimer</span>();
}

RotatingFileStream.prototype._setRotationTimer = function () {
var self = this;
var delay = this.rotAt - Date.now();
// Cap timeout to Node's max setTimeout, see
// &lt;https://github.com/joyent/node/issues/8656&gt;.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.bunyan.RotatingFileStream.prototype._setupNextRot" id="apidoc.element.bunyan.RotatingFileStream.prototype._setupNextRot">
        function <span class="apidocSignatureSpan">bunyan.RotatingFileStream.prototype.</span>_setupNextRot
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_setupNextRot = function () {
    this.rotAt = this._calcRotTime(1);
    this._setRotationTimer();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

this.rotQueue = [];
this.rotating = false;
if (rotateAfterOpen) {
    this._debug('rotateAfterOpen -&gt; call rotate()');
    this.rotate();
} else {
    this.<span class="apidocCodeKeywordSpan">_setupNextRot</span>();
}
}

util.inherits(RotatingFileStream, EventEmitter);

RotatingFileStream.prototype._debug = function () {
// Set this to `true` to add debug logging.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.bunyan.RotatingFileStream.prototype.destroy" id="apidoc.element.bunyan.RotatingFileStream.prototype.destroy">
        function <span class="apidocSignatureSpan">bunyan.RotatingFileStream.prototype.</span>destroy
        <span class="apidocSignatureSpan">(s)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function destroy(s) {
    this.stream.destroy();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 */
Logger.prototype.reopenFileStreams = function () {
var self = this;
self.streams.forEach(function (s) {
    if (s.type === 'file') {
        if (s.stream) {
            // Not sure if typically would want this, or more immediate
            // `s.stream.<span class="apidocCodeKeywordSpan">destroy</span>()`.
            s.stream.end();
            s.stream.destroySoon();
            delete s.stream;
        }
        s.stream = fs.createWriteStream(s.path,
            {flags: 'a', encoding: 'utf8'});
        s.stream.on('error', function (err) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.bunyan.RotatingFileStream.prototype.destroySoon" id="apidoc.element.bunyan.RotatingFileStream.prototype.destroySoon">
        function <span class="apidocSignatureSpan">bunyan.RotatingFileStream.prototype.</span>destroySoon
        <span class="apidocSignatureSpan">(s)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function destroySoon(s) {
    this.stream.destroySoon();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var self = this;
self.streams.forEach(function (s) {
    if (s.type === 'file') {
        if (s.stream) {
            // Not sure if typically would want this, or more immediate
            // `s.stream.destroy()`.
            s.stream.end();
            s.stream.<span class="apidocCodeKeywordSpan">destroySoon</span>();
            delete s.stream;
        }
        s.stream = fs.createWriteStream(s.path,
            {flags: 'a', encoding: 'utf8'});
        s.stream.on('error', function (err) {
            self.emit('error', err, s);
        });
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.bunyan.RotatingFileStream.prototype.end" id="apidoc.element.bunyan.RotatingFileStream.prototype.end">
        function <span class="apidocSignatureSpan">bunyan.RotatingFileStream.prototype.</span>end
        <span class="apidocSignatureSpan">(s)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function end(s) {
    this.stream.end();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  - perhaps this would be a "buffered: true" option on the stream object
  - then wrap the "stream" with a local class that handles the buffering
  - to finish this, need the 'log.close' and `process.on('exit', ...)`
    work that Trent has started.
- "canWrite" handling for full streams. Need to buffer a la log4js
- test file log with logadm rotation: does it handle that?
- test suite:
  - test for a cloned logger double-`stream.<span class="apidocCodeKeywordSpan">end</span>()` causing problems.
    Perhaps the "closeOnExit" for existing streams should be false for
    clones.
  - test that a `log.clone(...)` adding a new field matching a serializer
    works *and* that an existing field in the parent is not *re-serialized*.
- split out `bunyan` cli to a "bunyan" or "bunyan-reader" or "node-bunyan-reader"
as the basis for tools to consume bunyan logs. It can grow indep of node-bunyan
for generating the logs.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.bunyan.RotatingFileStream.prototype.rotate" id="apidoc.element.bunyan.RotatingFileStream.prototype.rotate">
        function <span class="apidocSignatureSpan">bunyan.RotatingFileStream.prototype.</span>rotate
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function rotate() {
    // XXX What about shutdown?
    var self = this;

    // If rotation period is &gt; ~25 days, we have to break into multiple
    // setTimeout's. See &lt;https://github.com/joyent/node/issues/8656&gt;.
    if (self.rotAt &amp;&amp; self.rotAt &gt; Date.now()) {
        return self._setRotationTimer();
    }

    this._debug('rotate');
    if (self.rotating) {
        throw new TypeError('cannot start a rotation when already rotating');
    }
    self.rotating = true;

    self.stream.end();  // XXX can do moves sync after this? test at high rate

    function del() {
        var toDel = self.path + '.' + String(n - 1);
        if (n === 0) {
            toDel = self.path;
        }
        n -= 1;
        self._debug('  rm %s', toDel);
        fs.unlink(toDel, function (delErr) {
            //XXX handle err other than not exists
            moves();
        });
    }

    function moves() {
        if (self.count === 0 || n &lt; 0) {
            return finish();
        }
        var before = self.path;
        var after = self.path + '.' + String(n);
        if (n &gt; 0) {
            before += '.' + String(n - 1);
        }
        n -= 1;
        fs.exists(before, function (exists) {
            if (!exists) {
                moves();
            } else {
                self._debug('  mv %s %s', before, after);
                mv(before, after, function (mvErr) {
                    if (mvErr) {
                        self.emit('error', mvErr);
                        finish(); // XXX finish here?
                    } else {
                        moves();
                    }
                });
            }
        })
    }

    function finish() {
        self._debug('  open %s', self.path);
        self.stream = fs.createWriteStream(self.path,
            {flags: 'a', encoding: 'utf8'});
        var q = self.rotQueue, len = q.length;
        for (var i = 0; i &lt; len; i++) {
            self.stream.write(q[i]);
        }
        self.rotQueue = [];
        self.rotating = false;
        self.emit('drain');
        self._setupNextRot();
    }

    var n = this.count;
    del();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    this.stream = fs.createWriteStream(this.path,
        {flags: 'a', encoding: 'utf8'});

    this.rotQueue = [];
    this.rotating = false;
    if (rotateAfterOpen) {
        this._debug('rotateAfterOpen -&gt; call rotate()');
        this.<span class="apidocCodeKeywordSpan">rotate</span>();
    } else {
        this._setupNextRot();
    }
}

util.inherits(RotatingFileStream, EventEmitter);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.bunyan.RotatingFileStream.prototype.write" id="apidoc.element.bunyan.RotatingFileStream.prototype.write">
        function <span class="apidocSignatureSpan">bunyan.RotatingFileStream.prototype.</span>write
        <span class="apidocSignatureSpan">(s)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function write(s) {
    if (this.rotating) {
        this.rotQueue.push(s);
        return false;
    } else {
        return this.stream.write(s);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
	    npm publish

.PHONY: docs
docs: toc
	@[[ `which ronn` ]] || (echo "No 'ronn' on your PATH. Install with 'gem install ronn'" &amp;&amp;
; exit 2)
	mkdir -p man/man1
	ronn --style=toc --manual="bunyan manual" --date=$(shell git log -1 --pretty=format:%cd --date=short) --roff --html docs
/bunyan.1.ronn
	python -c 'import sys; h = open("docs/bunyan.1.html").read(); h = h.replace(".mp dt.flush {float:left;width
:8ex}", ""); open("docs/bunyan.1.html", "w").<span class="apidocCodeKeywordSpan">write</span>(
h)'
	python -c 'import sys; h = open("docs/bunyan.1.html").read(); h = h.replace("&lt;/body&gt;", "
;""&lt;a href="https://github.com/trentm/node-bunyan"&gt;&lt;img style="position: absolute; top:
0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="
;Fork me on GitHub"&gt;&lt;/a&gt;&lt;/body&gt;"""); open("docs/bunyan.1.html", "w&amp;#
x22;).write(h)'
	@echo "# test with 'man ./docs/bunyan.1' and 'open ./docs/bunyan.1.html'"

# Re-generate the README.md table of contents.
toc:
	./node_modules/.bin/markdown-toc -i README.md
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.bunyan.stdSerializers" id="apidoc.module.bunyan.stdSerializers">module bunyan.stdSerializers</a></h1>


    <h2>
        <a href="#apidoc.element.bunyan.stdSerializers.err" id="apidoc.element.bunyan.stdSerializers.err">
        function <span class="apidocSignatureSpan">bunyan.stdSerializers.</span>err
        <span class="apidocSignatureSpan">(err)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">err = function (err) {
    if (!err || !err.stack)
        return err;
    var obj = {
        message: err.message,
        name: err.name,
        stack: getFullErrorStack(err),
        code: err.code,
        signal: err.signal
    }
    return obj;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
function mkRecord(log, minLevel, args) {
var excludeFields, fields, msgArgs;
if (args[0] instanceof Error) {
    // `log.&lt;level&gt;(err, ...)`
    fields = {
        // Use this Logger's err serializer, if defined.
        err: (log.serializers &amp;&amp; log.serializers.err
            ? log.serializers.<span class="apidocCodeKeywordSpan">err</span>(args[0])
            : Logger.stdSerializers.err(args[0]))
    };
    excludeFields = {err: true};
    if (args.length === 1) {
        msgArgs = [fields.err.message];
    } else {
        msgArgs = args.slice(1);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.bunyan.stdSerializers.req" id="apidoc.element.bunyan.stdSerializers.req">
        function <span class="apidocSignatureSpan">bunyan.stdSerializers.</span>req
        <span class="apidocSignatureSpan">(req)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">req = function (req) {
    if (!req || !req.connection)
        return req;
    return {
        method: req.method,
        url: req.url,
        headers: req.headers,
        remoteAddress: req.connection.remoteAddress,
        remotePort: req.connection.remotePort
    };
    // Trailers: Skipping for speed. If you need trailers in your app, then
    // make a custom serializer.
    //if (Object.keys(trailers).length &gt; 0) {
    //  obj.trailers = req.trailers;
    //}
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.bunyan.stdSerializers.res" id="apidoc.element.bunyan.stdSerializers.res">
        function <span class="apidocSignatureSpan">bunyan.stdSerializers.</span>res
        <span class="apidocSignatureSpan">(res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">res = function (res) {
    if (!res || !res.statusCode)
        return res;
    return {
        statusCode: res.statusCode,
        header: res._header
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>